pipeline:
  publish:
    image: plugins/docker
    secrets: [ docker_username, docker_password ]
    repo: josmo/grannec-web
    auto_tag: true
    file: Dockerfile
    when:
      event: [ push, tag ]

  deploy_dev:
    image: peloton/drone-k8s-deployment
    pull: true
    url: https://rancher.pelo.tech/k8s/clusters/c-ss4wc
    secrets: [ kubernetes_token ]
    namespaces: josmo
    deployment_names: grannec-web
    docker_image: "josmo/grannec-web:latest"
    container_names: grannec-web
    when:
      event: [ push ]
      branch: [ master ]

branches: [ master ]
